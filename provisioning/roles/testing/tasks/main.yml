---
- name: Assert that timezone has been changed to MDT
  command: date
  register: date
- assert:
    that: "'MDT' in date.stdout"

- name: Assert that Nexus returns a status 200 and page content has expected title
  uri:
    url: "{{ nexus_base_url }}"
    status_code: 200
    return_content: yes
  register: webpage
- assert:
    that: "'<title>Nexus Repository Manager</title>' in webpage.content"

- name: Assert that Nexus process was started by user '{{ nexus_os_user }}'
  shell: "ps aux | grep org.sonatype.nexus.karaf.NexusMain$"
  register: nexus_proc_info
- assert:
    # startswith(s) is a function from the Python standard library
    that: "nexus_proc_info.stdout.startswith('{{ nexus_os_user }}')"

- name: Assert that admin password was successfully changed to what we want
  uri:
    url: "{{ rest_api_endpoint }}"
    user: 'admin'
    password: "{{ nexus_admin_password }}"
    method: GET
    force_basic_auth: yes
    status_code: 200   # If the password hasn't been changed, we'll get a 404, which'll cause this task to fail.

- name: Test Git LFS.
  include: test-git-lfs.yml
  tags: ['test-git-lfs']
