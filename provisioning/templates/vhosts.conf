<VirtualHost *:80>
   ServerName {{ artifacts_hostname }}
   Redirect permanent / https://{{ artifacts_hostname }}/
</VirtualHost>

<VirtualHost *:443>
  ServerName {{ artifacts_hostname }}
  ServerAdmin {{ admin_email }}

  SSLEngine on
  SSLCertificateFile {{ ssl_cert_file }}
  SSLCertificateKeyFile {{ ssl_cert_key_file }}
  SSLCertificateChainFile {{ ssl_cert_chain_file }}

  ProxyPass / {{ nexus_private_base_url }}/
  ProxyPassReverse / {{ nexus_private_base_url }}/

  RequestHeader set X-Forwarded-Proto "https"

  ErrorLog "|/usr/bin/rotatelogs -l {{ artifacts_apache_log_dir }}/error_%Y-%m-%d.log 10M"
  CustomLog "|/usr/bin/rotatelogs -l {{ artifacts_apache_log_dir }}/access_%Y-%m-%d.log 10M" common
</VirtualHost>

<VirtualHost *:80>
  ServerName {{ thredds_doc_hostname }}
  ServerAdmin {{ admin_email }}

  ProxyPass / {{ nexus_private_base_url }}/repository/{{ nexus_repos_raw_hosted[0].name }}/
  ProxyPassReverse / {{ nexus_private_base_url }}/repository/{{ nexus_repos_raw_hosted[0].name }}/

  ErrorLog "|/usr/bin/rotatelogs -l {{ thredds_doc_apache_log_dir }}/error_%Y-%m-%d.log 10M"
  CustomLog "|/usr/bin/rotatelogs -l {{ thredds_doc_apache_log_dir }}/access_%Y-%m-%d.log 10M" common
</VirtualHost>
