<VirtualHost *:80>
   ServerName {{ artifacts_hostname }}
   Redirect permanent / https://{{ artifacts_hostname }}/
</VirtualHost>

<VirtualHost *:443>
  SSLEngine on
  SSLCertificateFile {{ ssl_certs_cert_path }}
  SSLCertificateKeyFile {{ ssl_certs_privkey_path }}

  ServerName {{ artifacts_hostname }}
  ServerAdmin {{ admin_email }}

  ProxyPass / {{ nexus_private_base_url }}/
  ProxyPassReverse / {{ nexus_private_base_url }}/

  RequestHeader set X-Forwarded-Proto "https"

  ErrorLog "|/usr/bin/rotatelogs -l {{ artifacts_apache_logs_dir }}/error_%Y-%m-%d.log 10M"
  CustomLog "|/usr/bin/rotatelogs -l {{ artifacts_apache_logs_dir }}/access_%Y-%m-%d.log 10M" common
</VirtualHost>

<VirtualHost *:80>
   ServerName {{ docs_hostname }}
   Redirect permanent / https://{{ docs_hostname }}/
</VirtualHost>

<VirtualHost *:443>
  SSLEngine on
  SSLCertificateFile {{ ssl_certs_cert_path }}
  SSLCertificateKeyFile {{ ssl_certs_privkey_path }}

  ServerName {{ docs_hostname }}
  ServerAdmin {{ admin_email }}

  ProxyPass / {{ nexus_private_base_url }}/repository/{{ nexus_repos_raw_hosted[0].name }}/
  ProxyPassReverse / {{ nexus_private_base_url }}/repository/{{ nexus_repos_raw_hosted[0].name }}/

  RequestHeader set X-Forwarded-Proto "https"

  ErrorLog "|/usr/bin/rotatelogs -l {{ docs_apache_logs_dir }}/error_%Y-%m-%d.log 10M"
  CustomLog "|/usr/bin/rotatelogs -l {{ docs_apache_logs_dir }}/access_%Y-%m-%d.log 10M" common
</VirtualHost>
