---
- name: Test playbook. Execute functional tests against a running Nexus server.
  hosts: all
  gather_facts: no
  become: no

  vars_files:
    - ../provisioning/vars/main.yml  # For 'application_port'.

  tasks:
    - name: Check that Nexus returns a status 200
      uri:
        url: "http://{{ ansible_host }}:{{ application_port }}/"
        status_code: 200
        return_content: yes
      register: webpage

    - name: Fail if expected title is not in the page content
      fail:
        msg: Nexus is not giving the expected response.
      when: "'<title>Nexus Repository Manager</title>' not in webpage.content"
